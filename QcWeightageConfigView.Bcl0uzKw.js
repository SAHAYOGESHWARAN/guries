import{r as l,A as b,j as e}from"./index.Cgn8UqAd.js";import{c as q,X as P,P as T,T as W,a as L}from"./x.BiCs_uOD.js";import{C as z}from"./circle-alert.CZRafKvQ.js";import{S as Q}from"./search.CVVJ0o-x.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],D=q("circle-check-big",F),M=["Draft","Review","Approved","Published","Pre-Publish","Post-Publish"];function R({config:i,onClose:N,onSave:C}){const[d,y]=l.useState({config_name:"",description:"",status:"active"}),[n,m]=l.useState([]),[h,k]=l.useState([]),[j,u]=l.useState(!1),[w,p]=l.useState(""),[f,_]=l.useState(0);l.useEffect(()=>{i&&(y(i),S(i.id)),E()},[i]),l.useEffect(()=>{const a=n.reduce((r,t)=>r+(t.weight_percentage||0),0);_(a)},[n]);const S=async a=>{try{const t=await(await fetch(`${b}/qc-weightage/${a}`)).json();m(t.items||[])}catch(r){console.error("Error fetching config details:",r)}},E=async()=>{try{const r=await(await fetch(`${b}/qc-weightage/list/checklists`)).json();k(r)}catch(a){console.error("Error fetching checklists:",a)}},g=a=>{const{name:r,value:t}=a.target;y(x=>({...x,[r]:t}))},s=()=>{m([...n,{checklist_id:0,checklist_type:"",weight_percentage:0,is_mandatory:!0,applies_to_stage:""}])},o=(a,r,t)=>{const x=[...n];if(r==="checklist_id"){const v=h.find(c=>c.id===parseInt(t));x[a]={...x[a],checklist_id:parseInt(t),checklist_name:v?.checklist_name,checklist_type:v?.checklist_type||""}}else x[a]={...x[a],[r]:t};m(x)},A=a=>{m(n.filter((r,t)=>t!==a))},$=async a=>{a.preventDefault(),p(""),u(!0);try{if(!d.config_name)throw new Error("Config name is required");if(n.length===0)throw new Error("At least one checklist item is required");if(f!==100)throw new Error(`Total weight must equal 100%, currently ${f}%`);if(n.some(c=>!c.checklist_id))throw new Error("All items must have a checklist selected");const r={...d,items:n.map(c=>({checklist_id:c.checklist_id,checklist_type:c.checklist_type,weight_percentage:c.weight_percentage,is_mandatory:c.is_mandatory,applies_to_stage:c.applies_to_stage||null}))},t=i?`${b}/qc-weightage/${i.id}`:`${b}/qc-weightage`,v=await fetch(t,{method:i?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!v.ok){const c=await v.json();throw new Error(c.error||"Failed to save config")}C()}catch(r){p(r.message)}finally{u(!1)}},I=f===100;return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center p-6 border-b sticky top-0 bg-white",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:i?"Edit QC Weightage Configuration":"Add New QC Weightage Configuration"}),e.jsx("button",{onClick:N,className:"text-gray-500 hover:text-gray-700 transition",children:e.jsx(P,{size:24})})]}),e.jsxs("form",{onSubmit:$,className:"p-6 space-y-6",children:[w&&e.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg text-red-700",children:w}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Basic Information"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Configuration Name *"}),e.jsx("input",{type:"text",name:"config_name",value:d.config_name,onChange:g,placeholder:"e.g., Content QC Weightage",required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{name:"description",value:d.description,onChange:g,placeholder:"Describe this weightage configuration...",rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Status"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"status",value:"active",checked:d.status==="active",onChange:g,className:"w-4 h-4"}),e.jsx("span",{className:"text-gray-700",children:"Active"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"status",value:"inactive",checked:d.status==="inactive",onChange:g,className:"w-4 h-4"}),e.jsx("span",{className:"text-gray-700",children:"Inactive"})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Checklist Weightage"}),e.jsxs("button",{type:"button",onClick:s,className:"flex items-center gap-2 bg-blue-600 text-white px-3 py-2 rounded-lg hover:bg-blue-700 transition text-sm",children:[e.jsx(T,{size:16}),"Add Checklist"]})]}),e.jsx("div",{className:`p-4 rounded-lg flex items-center gap-2 ${I?"bg-green-50 border border-green-200":"bg-orange-50 border border-orange-200"}`,children:I?e.jsxs(e.Fragment,{children:[e.jsx(D,{size:20,className:"text-green-600"}),e.jsx("span",{className:"text-green-700",children:"Total weight equals 100% ✓"})]}):e.jsxs(e.Fragment,{children:[e.jsx(z,{size:20,className:"text-orange-600"}),e.jsxs("span",{className:"text-orange-700",children:["Total weight is ",f,"%, must be 100%"]})]})}),e.jsx("div",{className:"space-y-3",children:n.map((a,r)=>e.jsx("div",{className:"border rounded-lg p-4 bg-gray-50",children:e.jsxs("div",{className:"grid grid-cols-6 gap-3 items-end",children:[e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Checklist *"}),e.jsxs("select",{value:a.checklist_id,onChange:t=>o(r,"checklist_id",t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",children:[e.jsx("option",{value:"",children:"Select checklist"}),h.map(t=>e.jsx("option",{value:t.id,children:t.checklist_name},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Type"}),e.jsx("input",{type:"text",value:a.checklist_type,disabled:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-100 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Weight (%) *"}),e.jsx("input",{type:"number",value:a.weight_percentage,onChange:t=>o(r,"weight_percentage",parseInt(t.target.value)),min:"0",max:"100",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Stage"}),e.jsxs("select",{value:a.applies_to_stage||"",onChange:t=>o(r,"applies_to_stage",t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm",children:[e.jsx("option",{value:"",children:"All Stages"}),M.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:a.is_mandatory,onChange:t=>o(r,"is_mandatory",t.target.checked),className:"w-4 h-4"}),e.jsx("span",{className:"text-xs text-gray-700",children:"Mandatory"})]}),e.jsx("button",{type:"button",onClick:()=>A(r),className:"p-2 text-red-600 hover:bg-red-50 rounded transition",children:e.jsx(W,{size:16})})]})]})},r))}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Total Items: ",n.length]})]}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:N,className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition font-medium",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:j||!I,className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition font-medium disabled:opacity-50",children:j?"Saving...":i?"Save Changes":"Add Configuration"})]})]})]})})}function O(){const[i,N]=l.useState([]),[C,d]=l.useState(!0),[y,n]=l.useState(""),[m,h]=l.useState(!1),[k,j]=l.useState(null),[u,w]=l.useState("all");l.useEffect(()=>{p()},[]);const p=async()=>{try{d(!0);const o=await(await fetch(`${b}/qc-weightage`)).json();N(o)}catch(s){console.error("Error fetching configs:",s)}finally{d(!1)}},f=()=>{j(null),h(!0)},_=s=>{j(s),h(!0)},S=async s=>{if(window.confirm("Are you sure you want to delete this configuration?"))try{await fetch(`${b}/qc-weightage/${s}`,{method:"DELETE"}),p()}catch(o){console.error("Error deleting config:",o)}},E=()=>{p(),h(!1)},g=i.filter(s=>{const o=s.config_name.toLowerCase().includes(y.toLowerCase()),A=u==="all"||s.status===u;return o&&A});return e.jsx("div",{className:"p-6 bg-gray-50 min-h-screen",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"QC Weightage Configuration"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Configure QC score weightage for checklists"})]}),e.jsxs("button",{onClick:f,className:"flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition",children:[e.jsx(T,{size:20}),"Add Configuration"]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow p-4 mb-6",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(Q,{className:"absolute left-3 top-3 text-gray-400",size:20}),e.jsx("input",{type:"text",placeholder:"Search by name...",value:y,onChange:s=>n(s.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("select",{value:u,onChange:s=>w(s.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"inactive",children:"Inactive"})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:C?e.jsx("div",{className:"p-8 text-center text-gray-500",children:"Loading configurations..."}):g.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500",children:"No configurations found"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-100 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:"Config Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:"Description"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:"Items"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:"Total Weight"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:"Valid"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{children:g.map(s=>e.jsxs("tr",{className:"border-b hover:bg-gray-50 transition",children:[e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900 font-medium",children:s.config_name}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600",children:s.description||"-"}),e.jsxs("td",{className:"px-6 py-4 text-sm text-gray-600",children:[s.item_count," items"]}),e.jsx("td",{className:"px-6 py-4 text-sm",children:e.jsxs("span",{className:"px-3 py-1 bg-blue-100 text-blue-800 rounded text-xs font-medium",children:[s.total_weight,"%"]})}),e.jsx("td",{className:"px-6 py-4 text-sm",children:s.is_valid?e.jsxs("div",{className:"flex items-center gap-1 text-green-600",children:[e.jsx(D,{size:18}),e.jsx("span",{children:"Valid"})]}):e.jsxs("div",{className:"flex items-center gap-1 text-red-600",children:[e.jsx(z,{size:18}),e.jsx("span",{children:"Invalid"})]})}),e.jsx("td",{className:"px-6 py-4 text-sm",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${s.status==="active"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:s.status==="active"?"✓ Active":"✗ Inactive"})}),e.jsx("td",{className:"px-6 py-4 text-sm",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>_(s),className:"p-2 text-blue-600 hover:bg-blue-50 rounded transition",title:"Edit config",children:e.jsx(L,{size:18})}),e.jsx("button",{onClick:()=>S(s.id),className:"p-2 text-red-600 hover:bg-red-50 rounded transition",title:"Delete config",children:e.jsx(W,{size:18})})]})})]},s.id))})]})})}),m&&e.jsx(R,{config:k,onClose:()=>h(!1),onSave:E})]})})}function J(){return e.jsx(O,{})}export{J as default};
