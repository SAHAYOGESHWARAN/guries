import{u as r,r as x,j as e,g as m,S}from"./index.Cgn8UqAd.js";import{T}from"./Table.qlFSYBMu.js";import{M as H}from"./Modal.Dm3XWcYn.js";import{D as X,C as Y,L as Z}from"./Charts.E4b3PdqH.js";import{r as L}from"./gemini.CcsfAiQp.js";import"./index.Cjd9_PBs.js";const ne=({campaignId:i,onNavigateBack:f})=>{const{data:A,update:$}=r("campaigns"),{data:D,update:M}=r("tasks"),{data:P}=r("content"),{data:O}=r("projects"),{data:b}=r("services"),{data:G}=r("campaignPerformance"),[n,U]=x.useState("overview"),[j,c]=x.useState(""),[p,d]=x.useState(!1),[R,h]=x.useState(!1),t=A.find(s=>s.id===i);if(!t)return e.jsxs("div",{className:"flex flex-col items-center justify-center h-96",children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-700",children:"Campaign Not Found"}),e.jsx("button",{onClick:f,className:"mt-4 text-blue-600 hover:underline",children:"Return to Campaigns"})]});const z=O.find(s=>s.id===t.project_id),l=D.filter(s=>s.campaign_id===i),o=P.filter(s=>s.linked_campaign_id===i),v=b.filter(s=>t.linked_service_ids?.includes(s.id)),N=t.backlinks_planned||1,y=t.backlinks_completed||0,k=Math.round(y/N*100),w=l.filter(s=>s.status==="completed").length,_=l.length>0?Math.round(w/l.length*100):0,u=G.filter(s=>s.campaign_id===i),g=u.filter(s=>s.metric_name==="traffic").map(s=>({label:s.date,value:s.metric_value})),B=async()=>{d(!0);try{const s=`
            Analyze this marketing campaign:
            Name: ${t.campaign_name}
            Type: ${t.campaign_type}
            Progress: ${k}% backlinks, ${_}% tasks.
            Tasks: ${JSON.stringify(l.map(C=>C.status))}
            Traffic Trend: ${JSON.stringify(g.slice(-5))}
            
            Provide a brief status report and 1 specific recommendation to improve performance.
          `,a=await L(s,{model:"gemini-2.5-flash"});c(a.text)}catch{c("Analysis unavailable at this time.")}finally{d(!1)}},I=async()=>{d(!0);try{const s=`Generate a high-level strategy for a ${t.campaign_type} campaign named "${t.campaign_name}".
          Goal: Increase organic traffic and leads.
          Target URL: ${t.target_url||"General Brand"}
          
          Output markdown:
          - **Objective**
          - **Target Audience**
          - **Key Messaging**
          - **Suggested Channels**`,a=await L(s,{model:"gemini-2.5-flash"});c(a.text)}catch{c("Strategy generation failed.")}finally{d(!1)}},E=async s=>{const a=s.status==="completed"?"in_progress":"completed";await M(s.id,{status:a})},J=async s=>{const a=t.linked_service_ids||[],q=a.includes(s)?a.filter(F=>F!==s):[...a,s];await $(t.id,{linked_service_ids:q})},K=async s=>{confirm("Create a working copy (draft) of this service page for editing?")&&(await fetch("/api/v1/content/draft-from-service",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({service_id:s,campaign_id:t.id})}),alert("Draft created in Assets tab."))},Q=async s=>{confirm("Are you sure? This will overwrite the live Service Master record with this content.")&&(await fetch(`/api/v1/content/publish-to-service/${s}`,{method:"POST"}),alert("Service Master updated successfully."))},V=[{header:"Task Name",accessor:"name"},{header:"Assignee",accessor:"primary_owner_id"},{header:"Due",accessor:"due_date"},{header:"Status",accessor:s=>m(s.status)},{header:"Action",accessor:s=>e.jsx("button",{onClick:()=>E(s),className:`text-xs px-2 py-1 rounded font-bold ${s.status==="completed"?"bg-yellow-100 text-yellow-700":"bg-green-100 text-green-700"}`,children:s.status==="completed"?"Reopen":"Complete"})}],W=[{header:"Title",accessor:"content_title_clean"},{header:"Type",accessor:"asset_type"},{header:"Status",accessor:s=>m(s.status)},{header:"Updated",accessor:s=>new Date(s.last_status_update_at).toLocaleDateString()},{header:"Master Sync",accessor:s=>s.asset_type==="service_page"&&s.linked_service_ids&&s.linked_service_ids.length>0?s.status==="qc_passed"||s.status==="ready_to_publish"?e.jsx("button",{onClick:()=>Q(s.id),className:"bg-green-600 text-white px-2 py-1 rounded text-xs font-bold hover:bg-green-700 transition-colors",children:"Push to Master"}):s.status==="published"?e.jsx("span",{className:"text-xs text-gray-400 italic",children:" synced"}):e.jsx("span",{className:"text-xs text-gray-400",children:"QC Pending"}):e.jsx("span",{className:"text-xs text-gray-300",children:"-"})}];return e.jsxs("div",{className:"space-y-6 h-full overflow-y-auto w-full pr-1 p-6 animate-fade-in",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:f,className:"p-2 rounded-full hover:bg-slate-200 transition-colors",children:e.jsx("svg",{className:"w-5 h-5 text-slate-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:t.campaign_name}),m(t.campaign_status)]}),e.jsxs("p",{className:"text-sm text-slate-500",children:["Part of Project: ",e.jsx("span",{className:"font-semibold text-blue-600",children:z?.project_name||"Unknown"})," â€¢ ID: ",t.id]})]})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs("button",{onClick:I,disabled:p,className:"bg-white border border-purple-200 text-purple-700 px-4 py-2 rounded-lg hover:bg-purple-50 flex items-center disabled:opacity-50 transition-colors",children:[e.jsx(S,{})," ",e.jsx("span",{className:"ml-2",children:"Generate Strategy"})]}),e.jsx("button",{onClick:B,disabled:p,className:"bg-gradient-to-r from-purple-600 to-indigo-600 text-white px-4 py-2 rounded-lg shadow-md hover:opacity-90 flex items-center disabled:opacity-50",children:e.jsx("span",{className:"ml-2",children:p?"Thinking...":"AI Status Report"})})]})]}),j&&e.jsxs("div",{className:"bg-purple-50 border border-purple-200 p-4 rounded-lg animate-slide-up",children:[e.jsxs("h3",{className:"text-purple-900 font-bold flex items-center mb-2",children:[e.jsx(S,{})," ",e.jsx("span",{className:"ml-2",children:"Gemini Intelligence"})]}),e.jsx("p",{className:"text-purple-800 text-sm whitespace-pre-wrap",children:j})]}),e.jsx("div",{className:"border-b border-slate-200",children:e.jsx("nav",{className:"-mb-px flex space-x-8",children:["overview","tasks","assets","analytics"].map(s=>e.jsx("button",{onClick:()=>U(s),className:`py-4 px-1 border-b-2 font-medium text-sm capitalize ${n===s?"border-blue-500 text-blue-600":"border-transparent text-slate-500 hover:text-slate-700 hover:border-slate-300"}`,children:s},s))})}),e.jsxs("div",{className:"min-h-[400px]",children:[n==="overview"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"md:col-span-2 bg-white rounded-xl shadow-card border border-slate-100 p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-slate-500 font-bold text-xs uppercase tracking-wider",children:"Campaign Scope & Services"}),e.jsx("button",{onClick:()=>h(!0),className:"text-xs bg-blue-50 text-blue-600 px-3 py-1 rounded hover:bg-blue-100 font-medium",children:"+ Link Service"})]}),v.length>0?e.jsx("div",{className:"space-y-3",children:v.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-50 rounded border border-slate-200",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-slate-700",children:s.service_name}),e.jsx("p",{className:"text-xs text-slate-500",children:s.slug})]}),e.jsx("button",{onClick:()=>K(s.id),className:"text-xs bg-white border border-slate-300 text-slate-700 px-3 py-1.5 rounded hover:bg-slate-100 shadow-sm",children:"Create Working Copy (Draft)"})]},s.id))}):e.jsx("p",{className:"text-sm text-slate-400 italic",children:"No services linked to this campaign yet."})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-card border border-slate-100",children:[e.jsx("h3",{className:"text-slate-500 font-bold text-xs uppercase tracking-wider mb-4",children:"Backlink Progress"}),e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-3xl font-bold text-slate-800",children:y}),e.jsxs("span",{className:"text-sm text-slate-500",children:["of ",N," target"]})]}),e.jsx("div",{className:"w-full bg-slate-100 rounded-full h-2.5",children:e.jsx("div",{className:"bg-blue-600 h-2.5 rounded-full transition-all duration-1000",style:{width:`${k}%`}})})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-card border border-slate-100",children:[e.jsx("h3",{className:"text-slate-500 font-bold text-xs uppercase tracking-wider mb-4",children:"Task Velocity"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-16 h-16",children:e.jsx(X,{value:_,color:"text-green-500",size:60})}),e.jsxs("div",{className:"ml-4",children:[e.jsxs("p",{className:"text-2xl font-bold text-slate-800",children:[w,"/",l.length]}),e.jsx("p",{className:"text-xs text-slate-500",children:"Tasks Completed"})]})]})]}),e.jsx("div",{children:e.jsxs("div",{className:"bg-white rounded-xl shadow-card border border-slate-100 overflow-hidden h-full",children:[e.jsx("div",{className:"px-6 py-5 border-b border-slate-50 bg-slate-50/50",children:e.jsxs("h3",{className:"font-bold text-slate-800",children:["Linked Assets (",o.length,")"]})}),e.jsxs("div",{className:"p-4 space-y-3",children:[o.slice(0,4).map(s=>e.jsxs("div",{className:"flex items-center justify-between text-sm p-2 hover:bg-slate-50 rounded",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-blue-400 mr-2"}),e.jsx("span",{className:"truncate max-w-[120px]",title:s.content_title_clean,children:s.content_title_clean})]}),m(s.status)]},s.id)),o.length===0&&e.jsx("p",{className:"text-center text-slate-400 text-sm py-4",children:"No content linked."})]})]})})]}),n==="tasks"&&e.jsx(T,{columns:V,data:l,title:"Execution Tasks"}),n==="assets"&&e.jsx(T,{columns:W,data:o,title:"Content & Creative Assets"}),n==="analytics"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(Y,{title:"Traffic Impact",children:g.length>0?e.jsx(Z,{data:g,color:"text-blue-500"}):e.jsx("div",{className:"flex items-center justify-center h-40 text-slate-400 italic",children:"No traffic data recorded yet."})}),e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-card border border-slate-100",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800 mb-4",children:"Performance Summary"}),e.jsxs("dl",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"p-4 bg-slate-50 rounded-lg",children:[e.jsx("dt",{className:"text-xs text-slate-500 uppercase",children:"Leads Generated"}),e.jsx("dd",{className:"text-2xl font-bold text-slate-800",children:u.find(s=>s.metric_name==="leads")?.metric_value||0})]}),e.jsxs("div",{className:"p-4 bg-slate-50 rounded-lg",children:[e.jsx("dt",{className:"text-xs text-slate-500 uppercase",children:"Conv. Rate"}),e.jsxs("dd",{className:"text-2xl font-bold text-slate-800",children:[u.find(s=>s.metric_name==="conversions")?.metric_value||0,"%"]})]})]})]})]})]}),e.jsx(H,{isOpen:R,onClose:()=>h(!1),title:"Link Services to Campaign",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"p-2 bg-slate-50 rounded border border-slate-200 text-sm text-slate-600",children:"Select services to manage within this campaign. Linking a service allows you to create working drafts."}),e.jsx("div",{className:"h-96 overflow-y-auto border border-slate-200 rounded-md",children:b.map(s=>e.jsxs("label",{className:"flex items-center p-3 hover:bg-slate-50 border-b border-slate-100 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t.linked_service_ids?.includes(s.id),onChange:()=>J(s.id),className:"h-4 w-4 text-indigo-600 rounded border-gray-300 focus:ring-indigo-500"}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:s.service_name}),e.jsx("p",{className:"text-xs text-gray-500",children:s.slug})]})]},s.id))}),e.jsx("div",{className:"flex justify-end pt-2",children:e.jsx("button",{onClick:()=>h(!1),className:"bg-slate-200 text-slate-700 px-4 py-2 rounded hover:bg-slate-300 text-sm font-medium",children:"Done"})})]})})]})};export{ne as default};
