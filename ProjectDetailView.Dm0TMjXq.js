import{r as k,j as e,u as $,g as A}from"./index.Cgn8UqAd.js";import{T as V}from"./Table.qlFSYBMu.js";import{M as I}from"./Modal.Dm3XWcYn.js";import"./index.Cjd9_PBs.js";const K=({items:d,dependencies:b=[],title:y})=>{const p=k.useMemo(()=>[...d].sort((s,a)=>new Date(s.start).getTime()-new Date(a.start).getTime()),[d]);if(p.length===0)return null;const u=new Date(p[0].start).getTime(),f=new Date(p.reduce((s,a)=>a.end>s.end?a:s,p[0]).end).getTime(),C=(f-u)*.05,g=u-C,_=f+C-g,i=s=>(new Date(s).getTime()-g)/_*100,o=56,D=30,v=s=>{const a=p.findIndex(h=>h.id===s);if(a===-1)return null;const l=p[a],n=i(l.start),c=i(l.end),j=a*o+o/2;return{startX:n,endX:c,y:j}},S=s=>{const a=s.toLowerCase();return a.includes("active")||a.includes("in_progress")?"bg-blue-500 border-blue-600":a.includes("completed")||a.includes("approved")?"bg-emerald-500 border-emerald-600":a.includes("planning")||a.includes("draft")?"bg-indigo-400 border-indigo-500":a.includes("blocked")||a.includes("failed")||a.includes("late")?"bg-rose-500 border-rose-600":"bg-slate-400 border-slate-500"};return e.jsxs("div",{className:"bg-white p-6 rounded-2xl shadow-card border border-slate-100 overflow-hidden",children:[y&&e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-lg font-bold text-slate-800",children:y}),e.jsxs("div",{className:"flex items-center space-x-3 text-xs",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"w-3 h-3 bg-blue-500 rounded-sm mr-1"})," Active"]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"w-3 h-3 bg-emerald-500 rounded-sm mr-1"})," Done"]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"w-3 h-3 bg-rose-500 rounded-sm mr-1"})," Blocked"]})]})]}),e.jsx("div",{className:"relative overflow-x-auto overflow-y-hidden",children:e.jsxs("div",{className:"min-w-[800px] relative",style:{height:p.length*o+D},children:[e.jsxs("div",{className:"absolute inset-0 border-b border-slate-100 flex justify-between text-xs text-slate-400 pt-2 px-2 pointer-events-none",children:[e.jsx("span",{children:new Date(g).toLocaleDateString()}),e.jsx("span",{children:new Date(g+_/2).toLocaleDateString()}),e.jsx("span",{children:new Date(g+_).toLocaleDateString()})]}),e.jsxs("div",{className:"absolute inset-0 flex justify-between pointer-events-none",children:[e.jsx("div",{className:"border-r border-slate-50 border-dashed h-full"}),e.jsx("div",{className:"border-r border-slate-50 border-dashed h-full"}),e.jsx("div",{className:"border-r border-slate-50 border-dashed h-full"})]}),e.jsxs("svg",{className:"absolute inset-0 w-full h-full pointer-events-none z-0",style:{top:D},children:[b.map((s,a)=>{const l=v(s.from),n=v(s.to);if(!l||!n)return null;const c=`${l.endX}%`,j=l.y,h=`${n.startX}%`,T=n.y;return(l.endX+n.startX)/2,e.jsx("g",{children:e.jsx("path",{d:`M ${c} ${j} C ${c} ${j}, ${c} ${T}, ${h} ${T}`,fill:"none",stroke:"#cbd5e1",strokeWidth:"2",strokeDasharray:n.startX<l.endX?"4":"0",markerEnd:"url(#arrowhead)"})},a)}),e.jsx("defs",{children:e.jsx("marker",{id:"arrowhead",markerWidth:"10",markerHeight:"7",refX:"9",refY:"3.5",orient:"auto",children:e.jsx("polygon",{points:"0 0, 10 3.5, 0 7",fill:"#cbd5e1"})})})]}),e.jsx("div",{className:"absolute inset-x-0 top-8 z-10",children:p.map((s,a)=>{const l=i(s.start),n=Math.max(i(s.end)-l,1);return e.jsxs("div",{className:"absolute h-10 w-full flex items-center group hover:z-20",style:{top:a*o},children:[e.jsx("div",{className:`absolute h-7 rounded-md shadow-sm border-l-4 text-white text-xs flex items-center px-2 cursor-pointer transition-all hover:scale-105 hover:shadow-md ${S(s.status)}`,style:{left:`${l}%`,width:`${n}%`},title:`${s.name} (${s.start} - ${s.end})`,children:e.jsx("span",{className:"truncate font-medium drop-shadow-md mr-2",children:s.name})}),l<50?e.jsx("div",{className:"absolute text-xs text-slate-500 font-medium truncate pl-2 pointer-events-none opacity-0 group-hover:opacity-100 transition-opacity",style:{left:`${l+n}%`},children:s.group&&e.jsxs("span",{className:"text-slate-300 mr-1",children:["[",s.group,"]"]})}):e.jsx("div",{className:"absolute text-xs text-slate-500 font-medium truncate pr-2 text-right pointer-events-none opacity-0 group-hover:opacity-100 transition-opacity",style:{right:`${100-l}%`},children:s.group&&e.jsxs("span",{className:"text-slate-300 mr-1",children:["[",s.group,"]"]})}),s.owner&&e.jsx("div",{className:"absolute flex items-center justify-center w-6 h-6 bg-white rounded-full border border-slate-200 shadow-sm z-20 -ml-3 hover:scale-110 transition-transform",style:{left:`${l}%`},title:`Assigned to: ${s.owner}`,children:s.ownerAvatar?e.jsx("img",{src:s.ownerAvatar,alt:s.owner,className:"w-full h-full rounded-full object-cover"}):e.jsx("span",{className:"text-[10px] font-bold text-slate-600",children:s.owner.charAt(0)})})]},s.id)})})]})})]})},q=({campaign:d})=>{const b=(d.backlinks_planned||0)>0?Math.round((d.backlinks_completed||0)/(d.backlinks_planned||0)*100):0;return e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-slate-200 flex flex-col h-full hover:shadow-md transition-shadow duration-200 group",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h3",{className:"font-bold text-slate-800 text-sm pr-2 leading-tight group-hover:text-indigo-600 transition-colors",children:d.campaign_name}),A(d.campaign_status)]}),e.jsx("p",{className:"text-xs text-slate-500 capitalize mb-4",children:(d.campaign_type||"").replace(/_/g," ")}),e.jsxs("div",{className:"mt-auto",children:[e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsx("span",{className:"text-[10px] font-bold text-slate-400 uppercase",children:"Progress"}),e.jsxs("span",{className:"text-[10px] font-bold text-indigo-600",children:[b,"%"]})]}),e.jsx("div",{className:"w-full bg-slate-100 rounded-full h-1.5",children:e.jsx("div",{className:"bg-indigo-600 h-1.5 rounded-full",style:{width:`${b}%`}})})]})]})},te=({projectId:d,onNavigateBack:b})=>{const{data:y,update:p}=$("projects"),{data:u}=$("campaigns"),{data:f,create:C,remove:g,update:_}=$("tasks"),{data:i}=$("users"),o=y.find(t=>t.id===d),[D,v]=k.useState(!1),[S,s]=k.useState(!1),[a,l]=k.useState({name:"",task_type:"general",campaign_id:0,primary_owner_id:0,due_date:"",status:"not_started"}),[n,c]=k.useState({}),j=k.useMemo(()=>{const t=u.filter(r=>r.project_id===d).map(r=>r.id),w=f.filter(r=>r.campaign_id&&t.includes(r.campaign_id)).map(r=>{const N=new Date(r.due_date||""),m=new Date(N);m.setDate(N.getDate()-5);const P=i.find(E=>E.id===r.primary_owner_id),U=u.find(E=>E.id===r.campaign_id);return{id:r.id,name:r.name,start:m.toISOString().split("T")[0],end:r.due_date||"",status:r.status,owner:P?.name,ownerAvatar:P?.avatar_url,group:U?.campaign_name,campaignId:r.campaign_id}}),O=[];return t.forEach(r=>{const N=w.filter(m=>m.campaignId===r).sort((m,P)=>new Date(m.end||"").getTime()-new Date(P.end||"").getTime());for(let m=0;m<N.length-1;m++)O.push({from:N[m].id,to:N[m+1].id})}),{items:w,dependencies:O}},[f,u,d,i]);if(!o)return e.jsxs("div",{className:"space-y-4 p-6 flex flex-col items-center justify-center h-full",children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-800",children:"Project not found"}),e.jsx("button",{onClick:b,className:"text-indigo-600 hover:underline text-sm",children:"Back to Projects"})]});const h=u.filter(t=>t.project_id===d),T=h.map(t=>t.id),H=f.filter(t=>t.campaign_id&&T.includes(t.campaign_id)),M=h.reduce((t,x)=>t+(x.backlinks_planned||0),0),z=h.reduce((t,x)=>t+(x.backlinks_completed||0),0),X=M>0?Math.round(z/M*100):0,B=async()=>{if(!a.campaign_id){alert("Please select a campaign.");return}await C({...a,id:Date.now()}),v(!1),l({name:"",task_type:"general",campaign_id:0,primary_owner_id:0,due_date:"",status:"not_started"})},L=async t=>{confirm("Delete this task permanently?")&&await g(t)},R=async t=>{const x=t.status==="completed"?"in_progress":"completed";await _(t.id,{status:x})},F=()=>{c({...o}),s(!0)},W=async()=>{await p(d,n),s(!1)},G=()=>{window.print()},Y=[{header:"Task Name",accessor:"name",className:"font-medium text-slate-900"},{header:"Campaign",accessor:t=>{const x=u.find(w=>w.id===t.campaign_id);return x?x.campaign_name:"-"},className:"text-slate-500"},{header:"Assigned To",accessor:t=>{const x=i.find(w=>w.id===t.primary_owner_id);return x?x.name:"Unassigned"}},{header:"Due Date",accessor:"due_date",className:"font-mono text-xs"},{header:"Status",accessor:t=>A(t.status)},{header:"Actions",accessor:t=>e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>R(t),className:`text-[10px] font-bold px-2 py-1 rounded uppercase tracking-wider ${t.status==="completed"?"bg-amber-50 text-amber-700":"bg-emerald-50 text-emerald-700"}`,children:t.status==="completed"?"Reopen":"Complete"}),e.jsx("button",{onClick:()=>L(t.id),className:"text-rose-600 hover:text-rose-800 text-xs font-bold print:hidden",children:"Delete"})]})}];return e.jsxs("div",{className:"space-y-6 h-full overflow-y-auto w-full pr-1 p-6 animate-fade-in",children:[e.jsxs("div",{className:"flex justify-between items-center print:hidden",children:[e.jsx("button",{onClick:b,className:"flex items-center text-slate-500 hover:text-slate-800 transition-colors font-medium text-sm",children:"← Back to Projects"}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:F,className:"bg-white border border-slate-300 text-slate-700 px-3 py-1.5 rounded-lg shadow-sm hover:bg-slate-50 text-xs font-medium transition-colors",children:"Edit Project"}),e.jsxs("button",{onClick:G,className:"bg-white border border-slate-300 text-slate-700 px-3 py-1.5 rounded-lg shadow-sm hover:bg-slate-50 flex items-center text-xs font-medium transition-colors",children:[e.jsx("svg",{className:"w-3 h-3 mr-1.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"})}),"Print Brief"]})]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-slate-200 print:shadow-none print:border print:border-black",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs("span",{className:"px-1.5 py-0.5 rounded text-[10px] font-bold bg-slate-100 text-slate-600 border border-slate-200 uppercase tracking-wide",children:["ID: ",o.id]}),A(o.project_status||"")]}),e.jsx("h1",{className:"text-2xl font-bold text-slate-800 tracking-tight",children:o.project_name}),e.jsxs("p",{className:"text-slate-500 mt-1 capitalize flex items-center text-sm",children:[(o.project_type||"").replace(/_/g," "),e.jsx("span",{className:"mx-2 text-slate-300",children:"•"}),e.jsxs("span",{className:"font-mono text-xs",children:[o.project_start_date," to ",o.project_end_date]})]})]}),e.jsxs("div",{className:"text-right hidden md:block print:block",children:[e.jsx("p",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-1",children:"Project Owner"}),e.jsxs("div",{className:"flex items-center justify-end",children:[e.jsx("div",{className:"w-6 h-6 rounded-full bg-indigo-600 text-white text-[10px] flex items-center justify-center font-bold mr-2 shadow-sm",children:i.find(t=>t.id===o.project_owner_id)?.name.charAt(0)}),e.jsx("span",{className:"font-medium text-slate-700 text-sm",children:i.find(t=>t.id===o.project_owner_id)?.name})]})]})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-1 md:grid-cols-3 gap-6 border-t border-slate-100 pt-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-end mb-2",children:[e.jsx("span",{className:"text-xs font-bold text-slate-500 uppercase tracking-wide",children:"Progress"}),e.jsxs("span",{className:"text-lg font-bold text-indigo-600",children:[X,"%"]})]}),e.jsx("div",{className:"w-full bg-slate-100 rounded-full h-2",children:e.jsx("div",{className:"bg-indigo-600 h-2 rounded-full print:bg-black transition-all duration-1000",style:{width:`${X}%`}})})]}),e.jsxs("div",{className:"bg-slate-50 p-3 rounded-lg border border-slate-200",children:[e.jsx("p",{className:"text-[10px] text-slate-500 uppercase font-bold tracking-wider",children:"Financial Snapshot"}),e.jsxs("div",{className:"flex justify-between items-baseline mt-1",children:[e.jsx("span",{className:"text-lg font-bold text-slate-800",children:"$12,450"}),e.jsx("span",{className:"text-[10px] font-bold text-emerald-700 bg-emerald-50 px-1.5 py-0.5 rounded border border-emerald-100",children:"On Budget"})]}),e.jsx("p",{className:"text-[10px] text-slate-400 mt-0.5",children:"Spend: 45% of allocated $28,000"})]}),e.jsxs("div",{className:"bg-slate-50 p-3 rounded-lg border border-slate-200",children:[e.jsx("p",{className:"text-[10px] text-slate-500 uppercase font-bold tracking-wider",children:"Risk Assessment"}),e.jsxs("div",{className:"flex justify-between items-baseline mt-1",children:[e.jsx("span",{className:"text-lg font-bold text-slate-800",children:"Low"}),e.jsx("span",{className:"text-[10px] font-bold text-indigo-700 bg-indigo-50 px-1.5 py-0.5 rounded border border-indigo-100",children:"Stable"})]}),e.jsx("p",{className:"text-[10px] text-slate-400 mt-0.5",children:"0 Critical blockers flagged"})]})]})]}),e.jsx("div",{className:"animate-fade-in",children:e.jsx(K,{items:j.items,dependencies:j.dependencies,title:"Resource Timeline"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-base font-bold text-slate-800 mb-3",children:"Active Campaigns"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:h.length>0?h.map(t=>e.jsx(q,{campaign:t},t.id)):e.jsx("p",{className:"text-slate-400 p-8 bg-slate-50 rounded-xl border border-dashed border-slate-200 text-center w-full col-span-full text-sm",children:"No campaigns found for this project."})})]}),e.jsx("div",{className:"break-inside-avoid",children:e.jsx(V,{columns:Y,data:H,title:"Task Manifest",actionButton:e.jsx("button",{onClick:()=>v(!0),className:"bg-indigo-600 text-white px-3 py-1.5 rounded-lg text-xs font-bold hover:bg-indigo-700 print:hidden shadow-sm transition-colors",children:"+ Add Task"})})}),e.jsx(I,{isOpen:D,onClose:()=>v(!1),title:"Create New Task",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-700 mb-1",children:"Task Name"}),e.jsx("input",{type:"text",value:a.name,onChange:t=>l({...a,name:t.target.value}),className:"block w-full px-3 py-2 border border-slate-300 rounded-lg text-sm focus:ring-indigo-500 focus:border-indigo-500",placeholder:"e.g., Finalize Keyword List"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-700 mb-1",children:"Campaign"}),e.jsxs("select",{value:a.campaign_id,onChange:t=>l({...a,campaign_id:parseInt(t.target.value)}),className:"block w-full px-3 py-2 border border-slate-300 rounded-lg text-sm bg-white",children:[e.jsx("option",{value:0,children:"Select Campaign..."}),h.map(t=>e.jsx("option",{value:t.id,children:t.campaign_name},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-700 mb-1",children:"Type"}),e.jsxs("select",{value:a.task_type,onChange:t=>l({...a,task_type:t.target.value}),className:"block w-full px-3 py-2 border border-slate-300 rounded-lg text-sm bg-white",children:[e.jsx("option",{value:"general",children:"General"}),e.jsx("option",{value:"content",children:"Content"}),e.jsx("option",{value:"seo",children:"SEO"}),e.jsx("option",{value:"backlink_build",children:"Backlink"}),e.jsx("option",{value:"design",children:"Design"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-700 mb-1",children:"Assignee"}),e.jsxs("select",{value:a.primary_owner_id,onChange:t=>l({...a,primary_owner_id:parseInt(t.target.value)}),className:"block w-full px-3 py-2 border border-slate-300 rounded-lg text-sm bg-white",children:[e.jsx("option",{value:0,children:"Unassigned"}),i.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-700 mb-1",children:"Due Date"}),e.jsx("input",{type:"date",value:a.due_date,onChange:t=>l({...a,due_date:t.target.value}),className:"block w-full px-3 py-2 border border-slate-300 rounded-lg text-sm"})]})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsx("button",{onClick:B,className:"bg-indigo-600 text-white px-4 py-2 rounded-lg text-sm font-bold hover:bg-indigo-700 shadow-sm transition-colors",children:"Create Task"})})]})}),e.jsx(I,{isOpen:S,onClose:()=>s(!1),title:"Edit Project Details",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-700 mb-1",children:"Project Name"}),e.jsx("input",{type:"text",value:n.project_name||"",onChange:t=>c({...n,project_name:t.target.value}),className:"block w-full px-3 py-2 border border-slate-300 rounded-lg text-sm"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-700 mb-1",children:"Status"}),e.jsxs("select",{value:n.project_status||"planning",onChange:t=>c({...n,project_status:t.target.value}),className:"block w-full px-3 py-2 border border-slate-300 rounded-lg text-sm bg-white",children:[e.jsx("option",{value:"planning",children:"Planning"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"on_hold",children:"On Hold"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"cancelled",children:"Cancelled"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-700 mb-1",children:"Project Owner"}),e.jsx("select",{value:n.project_owner_id||0,onChange:t=>c({...n,project_owner_id:parseInt(t.target.value)}),className:"block w-full px-3 py-2 border border-slate-300 rounded-lg text-sm bg-white",children:i.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-700 mb-1",children:"Start Date"}),e.jsx("input",{type:"date",value:n.project_start_date||"",onChange:t=>c({...n,project_start_date:t.target.value}),className:"block w-full px-3 py-2 border border-slate-300 rounded-lg text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-700 mb-1",children:"End Date"}),e.jsx("input",{type:"date",value:n.project_end_date||"",onChange:t=>c({...n,project_end_date:t.target.value}),className:"block w-full px-3 py-2 border border-slate-300 rounded-lg text-sm"})]})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsx("button",{onClick:W,className:"bg-indigo-600 text-white px-4 py-2 rounded-lg text-sm font-bold hover:bg-indigo-700 shadow-sm transition-colors",children:"Save Changes"})})]})})]})};export{te as default};
