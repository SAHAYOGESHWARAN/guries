================================================================================
SUPABASE DATABASE INITIALIZATION GUIDE
================================================================================

This guide explains how to initialize the Supabase PostgreSQL database
with the required schema for the Marketing Control Center application.

================================================================================
STEP 1: Access Supabase SQL Editor
================================================================================

1. Go to: https://app.supabase.com
2. Login with your account
3. Select project: nouyqizbqgoyscryexeg
4. Click "SQL Editor" in the left sidebar
5. Click "New Query" button

================================================================================
STEP 2: Create Database Schema
================================================================================

Copy and paste the following SQL into the SQL Editor:

-- Enable UUID extension
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

-- Users Table
CREATE TABLE IF NOT EXISTS users (
  id SERIAL PRIMARY KEY,
  name TEXT NOT NULL,
  email TEXT UNIQUE NOT NULL,
  role TEXT DEFAULT 'user',
  status TEXT DEFAULT 'active',
  password_hash TEXT,
  department TEXT,
  country TEXT,
  last_login TIMESTAMP,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Roles Table
CREATE TABLE IF NOT EXISTS roles (
  id SERIAL PRIMARY KEY,
  role_name TEXT UNIQUE NOT NULL,
  permissions TEXT,
  status TEXT DEFAULT 'active',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Brands Table
CREATE TABLE IF NOT EXISTS brands (
  id SERIAL PRIMARY KEY,
  name TEXT UNIQUE NOT NULL,
  code TEXT,
  industry TEXT,
  website TEXT,
  status TEXT DEFAULT 'active',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Services Table
CREATE TABLE IF NOT EXISTS services (
  id SERIAL PRIMARY KEY,
  service_name TEXT NOT NULL,
  service_code TEXT,
  slug TEXT,
  status TEXT DEFAULT 'draft',
  h1 TEXT,
  h2_list TEXT,
  h3_list TEXT,
  h4_list TEXT,
  h5_list TEXT,
  body_content TEXT,
  internal_links TEXT,
  external_links TEXT,
  image_alt_texts TEXT,
  meta_title TEXT,
  meta_description TEXT,
  focus_keywords TEXT,
  secondary_keywords TEXT,
  meta_keywords TEXT,
  og_title TEXT,
  og_description TEXT,
  og_image_url TEXT,
  twitter_title TEXT,
  twitter_description TEXT,
  twitter_image_url TEXT,
  schema_type_id INTEGER,
  robots_index TEXT,
  robots_follow TEXT,
  canonical_url TEXT,
  word_count INTEGER,
  reading_time_minutes INTEGER,
  version_number INTEGER DEFAULT 1,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Sub-Services Table
CREATE TABLE IF NOT EXISTS sub_services (
  id SERIAL PRIMARY KEY,
  service_id INTEGER NOT NULL REFERENCES services(id),
  sub_service_name TEXT NOT NULL,
  sub_service_code TEXT,
  slug TEXT,
  description TEXT,
  status TEXT DEFAULT 'draft',
  parent_service_id INTEGER REFERENCES services(id),
  h1 TEXT,
  h2_list TEXT,
  h3_list TEXT,
  h4_list TEXT,
  h5_list TEXT,
  body_content TEXT,
  internal_links TEXT,
  external_links TEXT,
  image_alt_texts TEXT,
  meta_title TEXT,
  meta_description TEXT,
  focus_keywords TEXT,
  secondary_keywords TEXT,
  meta_keywords TEXT,
  og_title TEXT,
  og_description TEXT,
  og_image_url TEXT,
  twitter_title TEXT,
  twitter_description TEXT,
  twitter_image_url TEXT,
  schema_type_id INTEGER,
  robots_index TEXT,
  robots_follow TEXT,
  canonical_url TEXT,
  word_count INTEGER,
  reading_time_minutes INTEGER,
  version_number INTEGER DEFAULT 1,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Assets Table (Core)
CREATE TABLE IF NOT EXISTS assets (
  id SERIAL PRIMARY KEY,
  asset_name TEXT NOT NULL,
  asset_type TEXT,
  asset_category TEXT,
  asset_format TEXT,
  status TEXT DEFAULT 'draft',
  qc_status TEXT,
  file_url TEXT,
  thumbnail_url TEXT,
  qc_score INTEGER,
  qc_checklist_items TEXT,
  submitted_by INTEGER REFERENCES users(id),
  submitted_at TIMESTAMP,
  qc_reviewer_id INTEGER REFERENCES users(id),
  qc_reviewed_at TIMESTAMP,
  qc_remarks TEXT,
  qc_checklist_completion INTEGER,
  linking_active INTEGER DEFAULT 0,
  rework_count INTEGER DEFAULT 0,
  workflow_log TEXT,
  workflow_stage TEXT DEFAULT 'draft',
  version_number INTEGER DEFAULT 1,
  version_history TEXT,
  created_by INTEGER REFERENCES users(id),
  updated_by INTEGER REFERENCES users(id),
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Asset Categories Table
CREATE TABLE IF NOT EXISTS asset_categories (
  id SERIAL PRIMARY KEY,
  category_name TEXT UNIQUE NOT NULL,
  description TEXT,
  status TEXT DEFAULT 'active',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Asset Formats Table
CREATE TABLE IF NOT EXISTS asset_formats (
  id SERIAL PRIMARY KEY,
  format_name TEXT UNIQUE NOT NULL,
  file_extension TEXT,
  mime_type TEXT,
  status TEXT DEFAULT 'active',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Asset Service Linking Table
CREATE TABLE IF NOT EXISTS asset_service_links (
  id SERIAL PRIMARY KEY,
  asset_id INTEGER NOT NULL REFERENCES assets(id),
  service_id INTEGER REFERENCES services(id),
  sub_service_id INTEGER REFERENCES sub_services(id),
  link_type TEXT,
  status TEXT DEFAULT 'active',
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- QC Reviews Table
CREATE TABLE IF NOT EXISTS qc_reviews (
  id SERIAL PRIMARY KEY,
  asset_id INTEGER NOT NULL REFERENCES assets(id),
  reviewer_id INTEGER NOT NULL REFERENCES users(id),
  qc_score INTEGER,
  qc_status TEXT,
  qc_remarks TEXT,
  checklist_items TEXT,
  review_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- QC Audit Log Table
CREATE TABLE IF NOT EXISTS qc_audit_log (
  id SERIAL PRIMARY KEY,
  asset_id INTEGER NOT NULL REFERENCES assets(id),
  user_id INTEGER NOT NULL REFERENCES users(id),
  action TEXT,
  old_value TEXT,
  new_value TEXT,
  remarks TEXT,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Projects Table
CREATE TABLE IF NOT EXISTS projects (
  id SERIAL PRIMARY KEY,
  name TEXT NOT NULL,
  description TEXT,
  status TEXT DEFAULT 'active',
  client TEXT,
  deadline DATE,
  budget DECIMAL(10, 2),
  created_by INTEGER REFERENCES users(id),
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Tasks Table
CREATE TABLE IF NOT EXISTS tasks (
  id SERIAL PRIMARY KEY,
  name TEXT NOT NULL,
  task_name TEXT NOT NULL,
  description TEXT,
  status TEXT DEFAULT 'pending',
  project_id INTEGER REFERENCES projects(id),
  assigned_to INTEGER REFERENCES users(id),
  priority TEXT DEFAULT 'medium',
  due_date DATE,
  created_by INTEGER REFERENCES users(id),
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Campaigns Table
CREATE TABLE IF NOT EXISTS campaigns (
  id SERIAL PRIMARY KEY,
  name TEXT NOT NULL,
  description TEXT,
  status TEXT DEFAULT 'draft',
  budget DECIMAL(10, 2),
  start_date DATE,
  end_date DATE,
  created_by INTEGER REFERENCES users(id),
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Create Indexes for Performance
CREATE INDEX IF NOT EXISTS idx_assets_status ON assets(status);
CREATE INDEX IF NOT EXISTS idx_assets_qc_status ON assets(qc_status);
CREATE INDEX IF NOT EXISTS idx_assets_created_by ON assets(created_by);
CREATE INDEX IF NOT EXISTS idx_qc_reviews_asset_id ON qc_reviews(asset_id);
CREATE INDEX IF NOT EXISTS idx_qc_reviews_reviewer_id ON qc_reviews(reviewer_id);
CREATE INDEX IF NOT EXISTS idx_asset_service_links_asset_id ON asset_service_links(asset_id);
CREATE INDEX IF NOT EXISTS idx_asset_service_links_service_id ON asset_service_links(service_id);
CREATE INDEX IF NOT EXISTS idx_users_email ON users(email);
CREATE INDEX IF NOT EXISTS idx_tasks_project_id ON tasks(project_id);
CREATE INDEX IF NOT EXISTS idx_tasks_assigned_to ON tasks(assigned_to);

================================================================================
STEP 3: Execute the Schema
================================================================================

1. Copy all the SQL above
2. Paste into the Supabase SQL Editor
3. Click the "Run" button (or press Ctrl+Enter)
4. Wait for the query to complete
5. You should see "Success" message

================================================================================
STEP 4: Verify Tables Were Created
================================================================================

Run this query to verify all tables were created:

SELECT table_name 
FROM information_schema.tables 
WHERE table_schema='public' 
ORDER BY table_name;

You should see these tables:
- asset_categories
- asset_formats
- asset_service_links
- assets
- brands
- campaigns
- projects
- qc_audit_log
- qc_reviews
- roles
- services
- sub_services
- tasks
- users

================================================================================
STEP 5: Verify Indexes Were Created
================================================================================

Run this query to verify indexes:

SELECT indexname 
FROM pg_indexes 
WHERE schemaname='public' 
ORDER BY indexname;

You should see all the idx_* indexes listed above.

================================================================================
STEP 6: Test Connection
================================================================================

Run this simple query to test the connection:

SELECT NOW();

You should see the current timestamp, confirming the database is working.

================================================================================
STEP 7: Create Initial Admin User (Optional)
================================================================================

If you want to create an initial admin user, run:

INSERT INTO users (name, email, role, status, password_hash, created_at, updated_at)
VALUES (
  'Admin User',
  'admin@example.com',
  'admin',
  'active',
  '$2a$10$KL271sXgLncfLQGyT7q/cOz.vYl1CiIy7tsaGWEgDe.b1cbosXMxq',
  NOW(),
  NOW()
);

Note: The password_hash is a bcrypt hash of "admin123"

================================================================================
TROUBLESHOOTING
================================================================================

Issue: "relation already exists" error
Solution: This is normal if tables already exist. The IF NOT EXISTS clause prevents errors.

Issue: "permission denied" error
Solution: Ensure you're using the correct database user (postgres) with proper permissions.

Issue: Connection timeout
Solution: Check your internet connection and Supabase project status.

Issue: Foreign key constraint errors
Solution: Ensure tables are created in the correct order (parent tables first).

================================================================================
NEXT STEPS
================================================================================

After initializing the database:

1. Update Vercel environment variables with:
   - DATABASE_URL
   - DB_PASSWORD
   - Other database configuration

2. Deploy frontend to Vercel

3. Test the application:
   - Create assets
   - Verify data persists
   - Test all CRUD operations

4. Monitor Vercel logs for any database connection issues

================================================================================
BACKUP & RECOVERY
================================================================================

Supabase automatically backs up your database:

1. Backups are created daily
2. Backups are retained for 7 days
3. To restore from backup:
   - Go to Supabase Dashboard
   - Click "Backups" in the left sidebar
   - Select the backup you want to restore
   - Click "Restore"

For more information, see Supabase documentation:
https://supabase.com/docs/guides/database/backups

================================================================================
